一、系统架构总览
graph TD
    A[用户终端] --> B(接入层)
    B --> C{API网关}
    C --> D[静态资源CDN]
    C --> E[意图识别集群]
    E --> F[商品匹配引擎]
    F --> G[购物车服务]
    G --> H[(Redis缓存)]
    C --> J[评价推荐服务]
    J --> K[(Neo4j图谱)]
    H --> L[订单中心]


二、核心模块深度设计
1. 意图识别与多模态交互
1.1 交互层设计
sequenceDiagram
    participant User
    participant App
    participant NLP
    participant CV
    participant IntentClassifier

    User->>App: 文字+图片消息（"需要DA弯头dn110，带图"）
    App->>NLP: 文本解析请求
    App->>CV: 图片特征提取
    NLP->>IntentClassifier: 语义分析结果
    CV->>IntentClassifier: 图片识别结果(
    IntentClassifier-->>App: 生成结构化意图
    App-->>User: 展示匹配商品（DA弯头农业专用配件，code:8020635）

对话式下单流程
用户输入 -> "要50个DA弯头 角度45度 dn110"
异常处置机制
完成基础意图识，商品特征抽取与槽位校准
冲突处理：当用户描述材质为"工程塑料"但商品表规定为"PVC-U"时，触发澄清流程
模糊匹配：用户输入"110管件"但存在dn110/de110多型号时，返回选项列表要求确认

sequenceDiagram
    actor 用户
    participant 前端
    participant 对话引擎
    participant 商品检索
    participant 数据验证
    participant 购物车服务

    用户->>前端: 发送消息（文字/语音/图片）
    前端->>对话引擎: 传递交互数据
    对话引擎->>对话引擎: 多模态处理（NLP+CV）
    
    alt 文字/语音输入
        对话引擎->>商品检索: 语义解析（SKU关键词提取）
    else 图片输入
        对话引擎->>商品检索: 图像特征匹配（条形码/SKU寻址）
    end
    
    商品检索->>数据验证: 执行商品匹配查询
    数据验证-->>商品检索: 返回候选商品列表
    商品检索->>前端: 展示确认卡片
    
    用户->>前端: 点击"确认添加"按钮
    前端->>购物车服务: 提交商品码+规格参数
    
    loop 多规格校验
        购物车服务->>数据验证: 验证规格兼容性
        数据验证-->>购物车服务: 返回可兼容规格树
    end
    
    购物车服务->>前端: 返回购物车更新结果
    前端-->>用户: 显示添加确认提示+展开购物车面板
    
    Note over 用户,商品检索: 跳转购物车后的操作流
    用户->>前端: 打开购物车详情页
    前端->>购物车服务: 获取完整购物车数据
    购物车服务-->>前端: 返回配送候选方案
    前端-->>用户: 展示经销商&配送选项

    加入购物车后
    graph TD
    A[购物车页面] --> B{订单确认页}
    B --> C[步骤1: 地址选择]
    C --> D[地址库选择/新增地址]
    B --> E[步骤2: 经销商选择]
    E --> F[基于地址筛选经销商]
    B --> G[提交订单]
    G --> H[生成待处理订单]
    H --> I[经销商后台处理]
